name: ðŸ§ª Build Development APK

on:
  pull_request:
    branches: [main]

jobs:
  build-development:
    name: ðŸ§ª Build Development Artifacts
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“‚ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸš€ Cache pub deps
        uses: actions/cache@v4
        with:
          path: ~/.pub-cache
          key: ${{ runner.os }}-pub-${{ hashFiles('**/pubspec.yaml') }}
          restore-keys: ${{ runner.os }}-pub-

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'
          
      - name: ðŸ“± Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.32.4'
          channel: 'stable'
          
      - name: ðŸ“¦ Install dependencies
        run: flutter pub get

      - name: ðŸ“‹ Get version from pubspec
        id: version
        run: |
          VERSION=$(grep '^version:' pubspec.yaml | sed 's/version: //')
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Version: $VERSION"

      - name: ðŸ“± Build Development APK
        run: flutter build apk --flavor dev --debug --build-number=${{ github.run_number }}
        
      - name: ðŸ“¦ Build Development App Bundle
        run: flutter build appbundle --flavor dev --debug --build-number=${{ github.run_number }}

      - name: ðŸ“¤ Upload Development APK
        uses: actions/upload-artifact@v4
        with:
          name: dienstplan-development-apk
          path: build/app/outputs/flutter-apk/dienstplan-${{ steps.version.outputs.version }}-dev-${{ github.run_number }}-debug.apk
          retention-days: 7

      - name: ðŸ“¤ Upload Development AAB
        uses: actions/upload-artifact@v4
        with:
          name: dienstplan-development-aab
          path: build/app/outputs/bundle/debug/dienstplan-${{ steps.version.outputs.version }}-dev-${{ github.run_number }}.aab
          retention-days: 7

      - name: ðŸ“Š Build Summary
        run: |
          echo "## ðŸ§ª Development Build Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Flavor:** Development" >> $GITHUB_STEP_SUMMARY
          echo "**Version:** ${{ steps.version.outputs.version }}" >> $GITHUB_STEP_SUMMARY
          echo "**Build Number:** ${{ github.run_number }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Artifacts:**" >> $GITHUB_STEP_SUMMARY
          echo "- APK: dienstplan-${{ steps.version.outputs.version }}-dev-${{ github.run_number }}-debug.apk" >> $GITHUB_STEP_SUMMARY
          echo "- AAB: dienstplan-${{ steps.version.outputs.version }}-dev-${{ github.run_number }}.aab" >> $GITHUB_STEP_SUMMARY 